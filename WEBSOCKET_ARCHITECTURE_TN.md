# ูููููุฉ ุงูู WebSocket ุงูุฌุฏูุฏุฉ (Architecture Explained)

ูุง ูุนููุ ุฑุชุจุชูู ุงูู Architecture ูุชุงุน ุงูู WebSockets ุจุงุด ุชููู ูุธููุฉ ูุณููุฉ ูู ุงูููู ูุงูุตูุงูุฉ. ูุงู ูููุงุด ููุช ููุณูุฉ:

ุงููุฌูุฏ ุงูุฌุฏูุฏ ุงุณูู `sockets/` ูููุฌูุฏ ูู ุงูู root ูุชุงุน ุงูุณูุฑูุฑ (ูุนูู `server/sockets/`).

## ุงูุชูุณููุฉ ุงูุฌุฏูุฏุฉ

### 1. `sockets/index.js` (ุงูููุจ ูุชุงุน ุงูู Socket)
ูุฐุง ุงูููู ูู ุงููู ููู ูู ุดู. ูู ุงููู ูุนูู initialization ููู Socket.IO ููุดุบู ูู ุงูู handlers.
- **ุดููุฉ ูุนูู:** ูุญู ุงูู connectionุ ูููุฒุน ุงูุฎุฏูุฉ ุนูู ุงูู handlers ูุฎุฑูู.
- **ูููุงุด ุชุณุชุนููู:** ูุง ุชุณุชุญูุด ุชูุณู ุจุฑุดุงุ ูุงู ูู ุชุญุจ ุชุฒูุฏ handler ุฌุฏูุฏ ูุงูู.

### 2. `sockets/handlers/` (ููู ุชุตูุฑ ุงูุฎุฏูุฉ ุงููู)
ูุณููุง ุงูู logic ุนูู ุญุณุจ ุงูุฏููููุ ุจุงุด ูุง ูุชุฎูุทุด ุนููู ุงูููุฏ:

*   **`reportHandlers.js`**:
    *   ูุงูู ุจูู ุดู ูุฎุต ุงูุชูุงุฑูุฑ (Crรฉation, Updates, Deletion).
    *   ูุณุชุนูู `socket.to('clinic_ID')` ุจุงุด ูุจุนุซ ูููููููู ูุงููุฉ.
    *   ููุณุชุนูู `socket.to('patient_ID')` ุจุงุด ูุจุนุซ ููุนุจุงุฏ ุงููู ูุงุชุญุฉ ุฏูุณู ุงููุฑูุถ ูุฐุงูุง ุจุงูุฐุงุช.

*   **`patientHandlers.js`**:
    *   ูุงูู ุจุงุฎุชูุงุฑ ุงููุฑูุถ (`select_patient`).
    *   ูุนูู ุงูู users ูุฎุฑูู ุฅุฐุง ููุง ุดููู ุฏุฎู ูุฎุฏู ุนูู ููุณ ุงููุฑูุถ.

*   **`userHandlers.js`**:
    *   ูุงูู ุจุงูู Login ู ุงูู Connection status ูุชุงุน ุงูู users.
    *   ูุนุฑู ุดููู componentctรฉ ูุดููู ูุง.

*   **`notificationHandlers.js`**:
    *   ูุงูู ุจุงูู Notifications (ุงูุฅุดุนุงุฑุงุช) ุงููู ุชูุตู ููู user ูุจุงุดุฑุฉ (ููู ูุง "Mark as read").

*   **`messagingHandlers.js`**:
    *   ูุงูู ุจุงูู Chat ูุงูู Typing indicators (ููุงู ููุชุจ...).

### 3. `sockets/services/` (ุฎุฏูุงุช ุฎุงุฑุฌูุฉ)
*   **`supabaseRealtime.js`**:
    *   ูุฐุง ูู "ุงูุฌุงุณูุณ" ูุชุงุนูุง ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (Supabase).
    *   **ุฃูู ูุงุญุฏ**: ูุณูุน ุฃู ุชุจุฏูู ูุตูุฑ ูู ุงูู DataBase (ูุซูุงู `report_ai` update/insert/delete) ููุจุนุซ ุทูู ููู Frontend ุนู ุทุฑูู ุงูู Socket.
    *   ููู Cache ุฐูู ุจุงุด ูุง ูุถูุนุด ุงูุฏููุงู ูู ูุตูุฑ delete.

### 4. `sockets/utils/` (ุฃุฏูุงุช ูุณุงุนุฏุฉ)
*   **`helpers.js`**:
    *   ููู ุฏูุงู ุตุบุงุฑ ุชุนุงููู ุจุงุด ุชุจุนุซ ููุณุงุฌุงุช ุจุณูููุฉ (ูุซูุงู `emitToClinic`, `emitToUser`).

---

## ูููุงุด ุชุฎุฏู ุงูู Data Flowุ (ุงูุณููุงุฑูู)

1.  **ุงูู Frontend**: ูุจุฏู ุญุงุฌุฉ ูู ุงูู Database (ูุซูุงู ูุนูู update ููู status).
2.  **Supabase**: ูููู ุจุงูุชุจุฏููุฉ ูุฐู.
3.  **Supabase Realtime**: ูุจุนุซ signal ููู Server ูุชุงุนูุง (`supabaseRealtime.js`).
4.  **ุงูู Server**: ูุดุฏ ุงูู signal ูุฐุงูุงุ ููููู ูุดููู ูุงุฒู ูุจุนุซู (ูููููููู ID ุงูููุงูู).
5.  **Socket.IO**: ูุจุนุซ ุงูู event ููู Frontend ูุชุงุน ุงููุงุณ ุงููู ุงููู ูููููุชูู.
6.  **ุงูู Frontend**: ููุตูู ุงูู event ููุญูู ุงูู Interface ุทูู ูู ุบูุฑ ูุง ูุนูู Refresh.

ูุธููุฉ ููุฑุชุจุฉุ ุชู ุชูุฌู ุชุฒูุฏ features ุฌุฏุฏ ูู ุบูุฑ ูุง ุชุชุนุจ ูุชูุฑูุณ ูู ููู ูุงุญุฏ ุทููู.
ุฌููู ุจุงูู! ๐
